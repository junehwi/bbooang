// Copyright (C) 2014 Company 100, Inc. All rights reserved.
//
// This software is supplied under the terms of a license agreement or
// nondisclosure agreement with Company 100, Inc. and may not be copied
// or disclosed except in accordance with the terms of that agreement.
'use strict';
var async = require('async');
var fs = require('fs');
var mysql = require('mysql');
var _ = require('underscore');
var database;

function initialize(callback) {
  var filePath = __dirname + '/config/database.json';

  fs.readFile(filePath, 'utf-8', function (err, data) {
    if (err) {
      return callback(err);
    }

    var configuration = JSON.parse(data);
    var defaultConfiguration = {
      debug: false,
      bigNumberStrings: true,
      supportBigNumbers: true,
      multipleStatements: true
    };
    var shopDatabaseConfiguration = configuration.shopDatabaseConfiguration;
    database = mysql.createPool(_.extend({
      host: shopDatabaseConfiguration.host,
      database: shopDatabaseConfiguration.database,
      user: shopDatabaseConfiguration.user,
      password: shopDatabaseConfiguration.password,
    }, defaultConfiguration));
    callback();
  });
}

exports.initialize = initialize;

exports.queryToDatabase = function(query, values, callback) {
  database.query({
    sql: query
  }, values, function (err, rows) {
    if (err) {
      console.log(err);
      return callback('DatabaseError');
    }
    callback(null, rows);
  });
};

/*
function escape(identifier) {
    return mysql.escape(identifier);
}

exports.escape = escape;

function end(callback) {
    var pools = [
        ticketDatabase,
        rankingDatabase,
        logDatabase,
        seasonDatabase,
        adminDatabase,
        boardDatabase,
        eventDatabase
    ].concat(gameDatabases).filter(function (pool) {
        return !!pool;
    });
    async.series(pools.map(function (pool) {
        return pool.end.bind(pool);
    }), callback);
}
exports.end = end;
;
*/
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRhdGFiYXNlLnRzIl0sIm5hbWVzIjpbImluaXRpYWxpemUiLCJpbml0aWFsaXplRm9yVGVzdCIsInF1ZXJ5VG9EYXRhYmFzZSIsInF1ZXJ5VGlja2V0RGF0YWJhc2UiLCJxdWVyeVJhbmtpbmdEYXRhYmFzZSIsInF1ZXJ5QWxsR2FtZURhdGFiYXNlcyIsInF1ZXJ5R2FtZURhdGFiYXNlIiwicXVlcnlMb2dEYXRhYmFzZSIsInF1ZXJ5U2Vhc29uRGF0YWJhc2UiLCJxdWVyeUFkbWluRGF0YWJhc2UiLCJxdWVyeUJvYXJkRGF0YWJhc2UiLCJxdWVyeUV2ZW50RGF0YWJhc2UiLCJ0cmFuc2FjdGlvbiIsInRyYW5zYWN0aW9uLlRyYW5zYWN0aW9uQ2xhc3MiLCJ0cmFuc2FjdGlvbi5UcmFuc2FjdGlvbkNsYXNzLmNvbnN0cnVjdG9yIiwidHJhbnNhY3Rpb24uVHJhbnNhY3Rpb25DbGFzcy5iZWdpbiIsInRyYW5zYWN0aW9uLlRyYW5zYWN0aW9uQ2xhc3MucXVlcnkiLCJ0cmFuc2FjdGlvbi5UcmFuc2FjdGlvbkNsYXNzLmNvbW1pdCIsInRyYW5zYWN0aW9uLlRyYW5zYWN0aW9uQ2xhc3Mucm9sbGJhY2siLCJ0cmFuc2FjdGlvbi5UcmFuc2FjdGlvbkNsYXNzLnJlbGVhc2UiLCJ0cmFuc2FjdGlvbi5nZXRDb25uZWN0aW9uRnJvbUdhbWVEQiIsInRyYW5zYWN0aW9uLmdldEdhbWVEQlRyYW5zYWN0aW9uIiwiZXNjYXBlIiwiZW5kIl0sIm1hcHBpbmdzIjoiQUFBQSxBQUtBLDREQUw0RDtBQUM1RCxFQUFFO0FBQ0Ysc0VBQXNFO0FBQ3RFLHVFQUF1RTtBQUN2RSxzRUFBc0U7QUFDdEUsWUFBWSxDQUFDO0FBRWIsSUFBTyxLQUFLLFdBQVcsT0FBTyxDQUFDLENBQUM7QUFDaEMsSUFBTyxFQUFFLFdBQVcsSUFBSSxDQUFDLENBQUM7QUFDMUIsSUFBTyxLQUFLLFdBQVcsT0FBTyxDQUFDLENBQUM7QUFDaEMsSUFBTyxDQUFDLFdBQVcsWUFBWSxDQUFDLENBQUM7QUFDakMsSUFBTyxPQUFPLFdBQVcsV0FBVyxDQUFDLENBQUM7QUFFdEMsSUFBSSxjQUEyQixDQUFDO0FBQ2hDLElBQUksZUFBNEIsQ0FBQztBQUNqQyxJQUFJLGFBQTRCLENBQUM7QUFDakMsSUFBSSxXQUF3QixDQUFDO0FBQzdCLElBQUksY0FBMkIsQ0FBQztBQUNoQyxJQUFJLGFBQTBCLENBQUM7QUFDL0IsSUFBSSxhQUEwQixDQUFDO0FBQy9CLElBQUksYUFBMEIsQ0FBQztBQUUvQixTQUFnQixVQUFVLENBQUMsT0FBZ0IsRUFBRSxRQUF1QjtJQUNsRUEsSUFBSUEsVUFBVUEsR0FBR0EsT0FBT0EsQ0FBQ0EsSUFBSUEsSUFBSUEsWUFBWUEsQ0FBQ0E7SUFDOUNBLElBQUlBLFFBQVFBLEdBQUdBLFNBQVNBLEdBQUdBLG1CQUFtQkEsR0FBR0EsVUFBVUEsR0FBR0EsT0FBT0EsQ0FBQ0E7SUFDdEVBLElBQUlBLFdBQVdBLEdBQUdBLE9BQU9BLENBQUNBLElBQUlBLEtBQUtBLGFBQWFBLENBQUNBO0lBRWpEQSxFQUFFQSxDQUFDQSxRQUFRQSxDQUFDQSxRQUFRQSxFQUFFQSxPQUFPQSxFQUFFQSxVQUFVQSxHQUFVQSxFQUFFQSxJQUFJQTtRQUN2RCxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ1IsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2hCLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLElBQUksYUFBYSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFckMsSUFBSSxvQkFBb0IsR0FBRztnQkFDekIsS0FBSyxFQUFFLFdBQVc7Z0JBQ2xCLGdCQUFnQixFQUFFLElBQUk7Z0JBQ3RCLGlCQUFpQixFQUFFLElBQUk7Z0JBQ3ZCLGtCQUFrQixFQUFFLElBQUk7YUFDekIsQ0FBQztZQUVGLElBQUksMkJBQTJCLEdBQUcsYUFBYSxDQUFDLDJCQUEyQixDQUFDO1lBQzVFLGNBQWMsR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7Z0JBQ3pDLElBQUksRUFBRSwyQkFBMkIsQ0FBQyxJQUFJO2dCQUN0QyxRQUFRLEVBQUUsMkJBQTJCLENBQUMsUUFBUTtnQkFDOUMsSUFBSSxFQUFFLDJCQUEyQixDQUFDLElBQUk7Z0JBQ3RDLFFBQVEsRUFBRSwyQkFBMkIsQ0FBQyxRQUFRO2FBQy9DLEVBQUUsb0JBQW9CLENBQUMsQ0FBQyxDQUFDO1lBRTFCLGFBQWEsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQywwQkFBMEIsRUFBRSxVQUFVLHlCQUE4QjtnQkFDdEcsTUFBTSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztvQkFDL0IsSUFBSSxFQUFFLHlCQUF5QixDQUFDLElBQUk7b0JBQ3BDLFFBQVEsRUFBRSx5QkFBeUIsQ0FBQyxRQUFRO29CQUM1QyxJQUFJLEVBQUUseUJBQXlCLENBQUMsSUFBSTtvQkFDcEMsUUFBUSxFQUFFLHlCQUF5QixDQUFDLFFBQVE7aUJBQzdDLEVBQUUsb0JBQW9CLENBQUMsQ0FBQyxDQUFDO1lBQzVCLENBQUMsQ0FBQyxDQUFDO1lBRUgsSUFBSSx3QkFBd0IsR0FBRyxhQUFhLENBQUMsd0JBQXdCLENBQUM7WUFDdEUsV0FBVyxHQUFHLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztnQkFDdEMsSUFBSSxFQUFFLHdCQUF3QixDQUFDLElBQUk7Z0JBQ25DLFFBQVEsRUFBRSx3QkFBd0IsQ0FBQyxRQUFRO2dCQUMzQyxJQUFJLEVBQUUsd0JBQXdCLENBQUMsSUFBSTtnQkFDbkMsUUFBUSxFQUFFLHdCQUF3QixDQUFDLFFBQVE7YUFDNUMsRUFBRSxvQkFBb0IsQ0FBQyxDQUFDLENBQUM7WUFFMUIsSUFBSSw0QkFBNEIsR0FBRyxhQUFhLENBQUMsNEJBQTRCLENBQUM7WUFDOUUsZUFBZSxHQUFHLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztnQkFDMUMsSUFBSSxFQUFFLDRCQUE0QixDQUFDLElBQUk7Z0JBQ3ZDLFFBQVEsRUFBRSw0QkFBNEIsQ0FBQyxRQUFRO2dCQUMvQyxJQUFJLEVBQUUsNEJBQTRCLENBQUMsSUFBSTtnQkFDdkMsUUFBUSxFQUFFLDRCQUE0QixDQUFDLFFBQVE7YUFDaEQsRUFBRSxvQkFBb0IsQ0FBQyxDQUFDLENBQUM7WUFFMUIsSUFBSSwyQkFBMkIsR0FBRyxhQUFhLENBQUMsMkJBQTJCLENBQUM7WUFDNUUsY0FBYyxHQUFHLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztnQkFDekMsSUFBSSxFQUFFLDJCQUEyQixDQUFDLElBQUk7Z0JBQ3RDLFFBQVEsRUFBRSwyQkFBMkIsQ0FBQyxRQUFRO2dCQUM5QyxJQUFJLEVBQUUsMkJBQTJCLENBQUMsSUFBSTtnQkFDdEMsUUFBUSxFQUFFLDJCQUEyQixDQUFDLFFBQVE7YUFDL0MsRUFBRSxvQkFBb0IsQ0FBQyxDQUFDLENBQUM7WUFFMUIsSUFBSSwwQkFBMEIsR0FBRyxhQUFhLENBQUMsMEJBQTBCLENBQUM7WUFDMUUsYUFBYSxHQUFHLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztnQkFDeEMsSUFBSSxFQUFFLDBCQUEwQixDQUFDLElBQUk7Z0JBQ3JDLFFBQVEsRUFBRSwwQkFBMEIsQ0FBQyxRQUFRO2dCQUM3QyxJQUFJLEVBQUUsMEJBQTBCLENBQUMsSUFBSTtnQkFDckMsUUFBUSxFQUFFLDBCQUEwQixDQUFDLFFBQVE7YUFDOUMsRUFBRSxvQkFBb0IsQ0FBQyxDQUFDLENBQUM7WUFFMUIsSUFBSSwwQkFBMEIsR0FBRyxhQUFhLENBQUMsMEJBQTBCLENBQUM7WUFDMUUsYUFBYSxHQUFHLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztnQkFDeEMsSUFBSSxFQUFFLDBCQUEwQixDQUFDLElBQUk7Z0JBQ3JDLFFBQVEsRUFBRSwwQkFBMEIsQ0FBQyxRQUFRO2dCQUM3QyxJQUFJLEVBQUUsMEJBQTBCLENBQUMsSUFBSTtnQkFDckMsUUFBUSxFQUFFLDBCQUEwQixDQUFDLFFBQVE7YUFDOUMsRUFBRSxvQkFBb0IsQ0FBQyxDQUFDLENBQUM7WUFFMUIsSUFBSSwwQkFBMEIsR0FBRyxhQUFhLENBQUMsMEJBQTBCLENBQUM7WUFDM0UsYUFBYSxHQUFHLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztnQkFDdkMsSUFBSSxFQUFFLDBCQUEwQixDQUFDLElBQUk7Z0JBQ3JDLFFBQVEsRUFBRSwwQkFBMEIsQ0FBQyxRQUFRO2dCQUM3QyxJQUFJLEVBQUUsMEJBQTBCLENBQUMsSUFBSTtnQkFDckMsUUFBUSxFQUFFLDBCQUEwQixDQUFDLFFBQVE7YUFDOUMsRUFBRSxvQkFBb0IsQ0FBQyxDQUFDLENBQUM7WUFFMUIsUUFBUSxFQUFFLENBQUM7UUFDYixDQUFDO0lBQ0gsQ0FBQyxDQUFDQSxDQUFDQTtBQUNMQSxDQUFDQTtBQXRGZSxrQkFBVSxHQUFWLFVBc0ZmLENBQUE7QUFBQSxDQUFDO0FBRUYsU0FBZ0IsaUJBQWlCLENBQUMsUUFBdUI7SUFDdkRDLFVBQVVBLENBQUNBLElBQUlBLE9BQU9BLENBQUNBLE1BQU1BLENBQUNBLEVBQUVBLFFBQVFBLENBQUNBLENBQUNBO0FBQzVDQSxDQUFDQTtBQUZlLHlCQUFpQixHQUFqQixpQkFFZixDQUFBO0FBRUQsU0FBUyxlQUFlLENBQUksUUFBcUIsRUFBRSxLQUFhLEVBQUUsTUFBVyxFQUFFLFFBQWdDO0lBQzdHQyxRQUFRQSxDQUFDQSxLQUFLQSxDQUFDQTtRQUNiQSxHQUFHQSxFQUFFQSxLQUFLQTtRQUNWQSxRQUFRQSxFQUFFQSxVQUFVQSxLQUFLQSxFQUFFQSxJQUFJQTtZQUM3QixFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxLQUFLLE1BQU0sSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2hELE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLEtBQUssR0FBRyxDQUFDO1lBQ2hDLENBQUM7WUFDRCxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDaEIsQ0FBQztLQUNGQSxFQUFFQSxNQUFNQSxFQUFFQSxVQUFVQSxHQUFpQkEsRUFBRUEsSUFBU0E7UUFDL0MsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNSLE9BQU8sQ0FBQyxLQUFLLENBQUMsZUFBZSxDQUFDLENBQUM7WUFDL0IsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNuQixPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUN6QixRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDaEIsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sUUFBUSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN2QixDQUFDO0lBQ0gsQ0FBQyxDQUFDQSxDQUFDQTtBQUNMQSxDQUFDQTtBQUVELFNBQWdCLG1CQUFtQixDQUFJLEtBQWEsRUFBRSxNQUFXLEVBQUUsUUFBZ0M7SUFDakdDLGVBQWVBLENBQUNBLGNBQWNBLEVBQUVBLEtBQUtBLEVBQUVBLE1BQU1BLEVBQUVBLFFBQVFBLENBQUNBLENBQUNBO0FBQzNEQSxDQUFDQTtBQUZlLDJCQUFtQixHQUFuQixtQkFFZixDQUFBO0FBQUEsQ0FBQztBQUVGLFNBQWdCLG9CQUFvQixDQUFJLEtBQWEsRUFBRSxNQUFXLEVBQUUsUUFBZ0M7SUFDbEdDLGVBQWVBLENBQUNBLGVBQWVBLEVBQUVBLEtBQUtBLEVBQUVBLE1BQU1BLEVBQUVBLFFBQVFBLENBQUNBLENBQUNBO0FBQzVEQSxDQUFDQTtBQUZlLDRCQUFvQixHQUFwQixvQkFFZixDQUFBO0FBQUEsQ0FBQztBQUVGLFNBQWdCLHFCQUFxQixDQUFDLEtBQWEsRUFBRSxNQUFXLEVBQUUsUUFBdUM7SUFDdkdDLElBQUlBLGNBQWNBLEdBQVFBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLGFBQWFBLEVBQUVBLFVBQVVBLFlBQXlCQTtRQUNoRixNQUFNLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxlQUFlLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNqRSxDQUFDLENBQUNBLENBQUNBO0lBQ0hBLEtBQUtBLENBQUNBLFFBQVFBLENBQUNBLGNBQWNBLEVBQUVBLFVBQVVBLEdBQWlCQSxFQUFFQSxXQUFvQkE7UUFDOUUsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNSLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNoQixDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztRQUN6QyxDQUFDO0lBQ0gsQ0FBQyxDQUFDQSxDQUFDQTtBQUNMQSxDQUFDQTtBQVhlLDZCQUFxQixHQUFyQixxQkFXZixDQUFBO0FBQUEsQ0FBQztBQUVGLFNBQWdCLGlCQUFpQixDQUFJLE1BQU0sRUFBRSxLQUFhLEVBQUUsTUFBVyxFQUFFLFFBQWdDO0lBQ3ZHQyxJQUFJQSxZQUFZQSxHQUFHQSxhQUFhQSxDQUFDQSxNQUFNQSxHQUFHQSxhQUFhQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtJQUVoRUEsZUFBZUEsQ0FBQ0EsWUFBWUEsRUFBRUEsS0FBS0EsRUFBRUEsTUFBTUEsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0E7QUFDekRBLENBQUNBO0FBSmUseUJBQWlCLEdBQWpCLGlCQUlmLENBQUE7QUFBQSxDQUFDO0FBRUYsU0FBZ0IsZ0JBQWdCLENBQUksS0FBYSxFQUFFLE1BQVcsRUFBRSxRQUFnQztJQUM5RkMsZUFBZUEsQ0FBQ0EsV0FBV0EsRUFBRUEsS0FBS0EsRUFBRUEsTUFBTUEsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0E7QUFDeERBLENBQUNBO0FBRmUsd0JBQWdCLEdBQWhCLGdCQUVmLENBQUE7QUFBQSxDQUFDO0FBRUYsU0FBZ0IsbUJBQW1CLENBQUksS0FBYSxFQUFFLE1BQVcsRUFBRSxRQUFnQztJQUNqR0MsZUFBZUEsQ0FBQ0EsY0FBY0EsRUFBRUEsS0FBS0EsRUFBRUEsTUFBTUEsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0E7QUFDM0RBLENBQUNBO0FBRmUsMkJBQW1CLEdBQW5CLG1CQUVmLENBQUE7QUFBQSxDQUFDO0FBRUYsU0FBZ0Isa0JBQWtCLENBQUksS0FBYSxFQUFFLE1BQVcsRUFBRSxRQUFnQztJQUNoR0MsZUFBZUEsQ0FBQ0EsYUFBYUEsRUFBRUEsS0FBS0EsRUFBRUEsTUFBTUEsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0E7QUFDMURBLENBQUNBO0FBRmUsMEJBQWtCLEdBQWxCLGtCQUVmLENBQUE7QUFBQSxDQUFDO0FBRUYsU0FBZ0Isa0JBQWtCLENBQUksS0FBYSxFQUFFLE1BQVcsRUFBRSxRQUFnQztJQUNoR0MsZUFBZUEsQ0FBQ0EsYUFBYUEsRUFBRUEsS0FBS0EsRUFBRUEsTUFBTUEsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0E7QUFDMURBLENBQUNBO0FBRmUsMEJBQWtCLEdBQWxCLGtCQUVmLENBQUE7QUFBQSxDQUFDO0FBRUYsU0FBZ0Isa0JBQWtCLENBQUksS0FBYSxFQUFFLE1BQVcsRUFBRSxRQUFnQztJQUNoR0MsZUFBZUEsQ0FBQ0EsYUFBYUEsRUFBRUEsS0FBS0EsRUFBRUEsTUFBTUEsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0E7QUFDMURBLENBQUNBO0FBRmUsMEJBQWtCLEdBQWxCLGtCQUVmLENBQUE7QUFBQSxDQUFDO0FBRUYsSUFBYyxXQUFXLENBNER4QjtBQTVERCxXQUFjLFlBQVcsRUFBQyxDQUFDO0lBQ3pCQyxJQUFhQSxnQkFBZ0JBO1FBRTNCQyxTQUZXQSxnQkFBZ0JBLENBRWZBLFVBQTZCQTtZQUN2Q0MsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsVUFBVUEsQ0FBQ0E7UUFDL0JBLENBQUNBO1FBRURELGdDQUFLQSxHQUFMQSxVQUFTQSxRQUFnQ0E7WUFDdkNFLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0E7UUFDN0NBLENBQUNBO1FBRURGLGdDQUFLQSxHQUFMQSxVQUFTQSxLQUFhQSxFQUFFQSxNQUFXQSxFQUFFQSxRQUFnQ0E7WUFDbkVHLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLEtBQUtBLENBQUNBO2dCQUNwQkEsR0FBR0EsRUFBRUEsS0FBS0E7Z0JBQ1ZBLFFBQVFBLEVBQUVBLFVBQVVBLEtBQUtBLEVBQUVBLElBQUlBO29CQUM3QixFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxLQUFLLE1BQU0sSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ2hELE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLEtBQUssR0FBRyxDQUFDO29CQUNoQyxDQUFDO29CQUNELE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDaEIsQ0FBQzthQUNGQSxFQUFFQSxNQUFNQSxFQUFFQSxVQUFVQSxHQUFpQkEsRUFBRUEsSUFBU0E7Z0JBQy9DLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7b0JBQ1IsT0FBTyxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQztvQkFDL0IsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDbkIsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7b0JBQ3pCLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDaEIsQ0FBQztnQkFBQyxJQUFJLENBQUMsQ0FBQztvQkFDTixRQUFRLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO2dCQUN2QixDQUFDO1lBQ0gsQ0FBQyxDQUFDQSxDQUFDQTtRQUNMQSxDQUFDQTtRQUVESCxpQ0FBTUEsR0FBTkEsVUFBVUEsUUFBZ0NBO1lBQ3hDSSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQTtRQUNuQ0EsQ0FBQ0E7UUFFREosbUNBQVFBLEdBQVJBLFVBQVlBLFFBQXVCQTtZQUNqQ0ssSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0E7UUFDckNBLENBQUNBO1FBRURMLGtDQUFPQSxHQUFQQSxVQUFXQSxRQUF1QkE7WUFDaENNLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLE9BQU9BLEVBQUVBLENBQUNBO1lBQzFCQSxRQUFRQSxFQUFFQSxDQUFDQTtRQUNiQSxDQUFDQTtRQUNITix1QkFBQ0E7SUFBREEsQ0EzQ0FELEFBMkNDQyxJQUFBRDtJQTNDWUEsNkJBQWdCQSxHQUFoQkEsZ0JBMkNaQSxDQUFBQTtJQUVEQSxTQUFTQSx1QkFBdUJBLENBQUlBLE1BQWNBLEVBQUVBLFFBQWFBO1FBQy9EUSxJQUFJQSxZQUFZQSxHQUFHQSxhQUFhQSxDQUFDQSxNQUFNQSxHQUFHQSxhQUFhQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUNoRUEsWUFBWUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0E7SUFDdkNBLENBQUNBO0lBRURSLFNBQWdCQSxvQkFBb0JBLENBQUNBLE1BQWNBLEVBQUVBLFFBQTBFQTtRQUM3SFMsdUJBQXVCQSxDQUFDQSxNQUFNQSxFQUFFQSxVQUFVQSxHQUFVQSxFQUFFQSxVQUE2QkE7WUFDakYsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDUixRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDaEIsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNOLFFBQVEsQ0FBQyxJQUFJLEVBQUUsSUFBSSxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQ25ELENBQUM7UUFDSCxDQUFDLENBQUNBLENBQUNBO0lBQ0xBLENBQUNBO0lBUmVULGlDQUFvQkEsR0FBcEJBLG9CQVFmQSxDQUFBQTtJQUFBQSxDQUFDQTtBQUNKQSxDQUFDQSxFQTVEYSxXQUFXLEdBQVgsbUJBQVcsS0FBWCxtQkFBVyxRQTREeEI7QUFBQSxDQUFDO0FBRUYsU0FBZ0IsTUFBTSxDQUFDLFVBQWU7SUFDcENVLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLFVBQVVBLENBQUNBLENBQUNBO0FBQ2xDQSxDQUFDQTtBQUZlLGNBQU0sR0FBTixNQUVmLENBQUE7QUFBQSxDQUFDO0FBRUYsU0FBZ0IsR0FBRyxDQUFDLFFBQXdCO0lBQzFDQyxJQUFJQSxLQUFLQSxHQUFrQkE7UUFDekJBLGNBQWNBO1FBQ2RBLGVBQWVBO1FBQ2ZBLFdBQVdBO1FBQ1hBLGNBQWNBO1FBQ2RBLGFBQWFBO1FBQ2JBLGFBQWFBO1FBQ2JBLGFBQWFBO0tBQ2RBLENBQ0FBLE1BQU1BLENBQUNBLGFBQWFBLENBQUNBLENBQ3JCQSxNQUFNQSxDQUFDQSxVQUFVQSxJQUFpQkE7UUFDakMsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDaEIsQ0FBQyxDQUFDQSxDQUFDQTtJQUVIQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxVQUFVQSxJQUFpQkE7UUFDaEQsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzdCLENBQUMsQ0FBQ0EsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0E7QUFDaEJBLENBQUNBO0FBbEJlLFdBQUcsR0FBSCxHQWtCZixDQUFBO0FBQUEsQ0FBQyIsImZpbGUiOiJkYXRhYmFzZS5qcyIsInNvdXJjZVJvb3QiOiIvVXNlcnMvZ3VyYWp1bnkvV29ya3NwYWNlL0J1ZGR5UnVzaFNlcnZlci8iLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKEMpIDIwMTQgQ29tcGFueSAxMDAsIEluYy4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbi8vXG4vLyBUaGlzIHNvZnR3YXJlIGlzIHN1cHBsaWVkIHVuZGVyIHRoZSB0ZXJtcyBvZiBhIGxpY2Vuc2UgYWdyZWVtZW50IG9yXG4vLyBub25kaXNjbG9zdXJlIGFncmVlbWVudCB3aXRoIENvbXBhbnkgMTAwLCBJbmMuIGFuZCBtYXkgbm90IGJlIGNvcGllZFxuLy8gb3IgZGlzY2xvc2VkIGV4Y2VwdCBpbiBhY2NvcmRhbmNlIHdpdGggdGhlIHRlcm1zIG9mIHRoYXQgYWdyZWVtZW50LlxuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgYXN5bmMgPSByZXF1aXJlKCdhc3luYycpO1xuaW1wb3J0IGZzID0gcmVxdWlyZSgnZnMnKTtcbmltcG9ydCBteXNxbCA9IHJlcXVpcmUoJ215c3FsJyk7XG5pbXBvcnQgXyA9IHJlcXVpcmUoJ3VuZGVyc2NvcmUnKTtcbmltcG9ydCBPcHRpb25zID0gcmVxdWlyZSgnLi9vcHRpb25zJyk7XG5cbnZhciB0aWNrZXREYXRhYmFzZTogbXlzcWwuSVBvb2w7XG52YXIgcmFua2luZ0RhdGFiYXNlOiBteXNxbC5JUG9vbDtcbnZhciBnYW1lRGF0YWJhc2VzOiBteXNxbC5JUG9vbFtdO1xudmFyIGxvZ0RhdGFiYXNlOiBteXNxbC5JUG9vbDtcbnZhciBzZWFzb25EYXRhYmFzZTogbXlzcWwuSVBvb2w7XG52YXIgYWRtaW5EYXRhYmFzZTogbXlzcWwuSVBvb2w7XG52YXIgYm9hcmREYXRhYmFzZTogbXlzcWwuSVBvb2w7XG52YXIgZXZlbnREYXRhYmFzZTogbXlzcWwuSVBvb2w7XG5cbmV4cG9ydCBmdW5jdGlvbiBpbml0aWFsaXplKG9wdGlvbnM6IE9wdGlvbnMsIGNhbGxiYWNrOiBFcnJvckNhbGxiYWNrKSB7XG4gIHZhciBzZXJ2ZXJNb2RlID0gb3B0aW9ucy5tb2RlIHx8ICdwcm9kdWN0aW9uJztcbiAgdmFyIGZpbGVQYXRoID0gX19kaXJuYW1lICsgJy9jb25maWcvZGF0YWJhc2VfJyArIHNlcnZlck1vZGUgKyAnLmpzb24nO1xuICB2YXIgaXNEZWJ1Z01vZGUgPSBvcHRpb25zLm1vZGUgPT09ICdkZXZlbG9wbWVudCc7XG5cbiAgZnMucmVhZEZpbGUoZmlsZVBhdGgsICd1dGYtOCcsIGZ1bmN0aW9uIChlcnI6IEVycm9yLCBkYXRhKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGNvbmZpZ3VyYXRpb24gPSBKU09OLnBhcnNlKGRhdGEpO1xuXG4gICAgICB2YXIgZGVmYXVsdENvbmZpZ3VyYXRpb24gPSB7XG4gICAgICAgIGRlYnVnOiBpc0RlYnVnTW9kZSxcbiAgICAgICAgYmlnTnVtYmVyU3RyaW5nczogdHJ1ZSxcbiAgICAgICAgc3VwcG9ydEJpZ051bWJlcnM6IHRydWUsXG4gICAgICAgIG11bHRpcGxlU3RhdGVtZW50czogdHJ1ZVxuICAgICAgfTtcblxuICAgICAgdmFyIHRpY2tldERhdGFiYXNlQ29uZmlndXJhdGlvbiA9IGNvbmZpZ3VyYXRpb24udGlja2V0RGF0YWJhc2VDb25maWd1cmF0aW9uO1xuICAgICAgdGlja2V0RGF0YWJhc2UgPSBteXNxbC5jcmVhdGVQb29sKF8uZXh0ZW5kKHtcbiAgICAgICAgaG9zdDogdGlja2V0RGF0YWJhc2VDb25maWd1cmF0aW9uLmhvc3QsXG4gICAgICAgIGRhdGFiYXNlOiB0aWNrZXREYXRhYmFzZUNvbmZpZ3VyYXRpb24uZGF0YWJhc2UsXG4gICAgICAgIHVzZXI6IHRpY2tldERhdGFiYXNlQ29uZmlndXJhdGlvbi51c2VyLFxuICAgICAgICBwYXNzd29yZDogdGlja2V0RGF0YWJhc2VDb25maWd1cmF0aW9uLnBhc3N3b3JkLFxuICAgICAgfSwgZGVmYXVsdENvbmZpZ3VyYXRpb24pKTtcblxuICAgICAgZ2FtZURhdGFiYXNlcyA9IF8ubWFwKGNvbmZpZ3VyYXRpb24uZ2FtZURhdGFiYXNlQ29uZmlndXJhdGlvbnMsIGZ1bmN0aW9uIChnYW1lRGF0YWJhc2VDb25maWd1cmF0aW9uOiBhbnkpIHtcbiAgICAgICAgcmV0dXJuIG15c3FsLmNyZWF0ZVBvb2woXy5leHRlbmQoe1xuICAgICAgICAgIGhvc3Q6IGdhbWVEYXRhYmFzZUNvbmZpZ3VyYXRpb24uaG9zdCxcbiAgICAgICAgICBkYXRhYmFzZTogZ2FtZURhdGFiYXNlQ29uZmlndXJhdGlvbi5kYXRhYmFzZSxcbiAgICAgICAgICB1c2VyOiBnYW1lRGF0YWJhc2VDb25maWd1cmF0aW9uLnVzZXIsXG4gICAgICAgICAgcGFzc3dvcmQ6IGdhbWVEYXRhYmFzZUNvbmZpZ3VyYXRpb24ucGFzc3dvcmQsXG4gICAgICAgIH0sIGRlZmF1bHRDb25maWd1cmF0aW9uKSk7XG4gICAgICB9KTtcblxuICAgICAgdmFyIGxvZ0RhdGFiYXNlQ29uZmlndXJhdGlvbiA9IGNvbmZpZ3VyYXRpb24ubG9nRGF0YWJhc2VDb25maWd1cmF0aW9uO1xuICAgICAgbG9nRGF0YWJhc2UgPSBteXNxbC5jcmVhdGVQb29sKF8uZXh0ZW5kKHtcbiAgICAgICAgaG9zdDogbG9nRGF0YWJhc2VDb25maWd1cmF0aW9uLmhvc3QsXG4gICAgICAgIGRhdGFiYXNlOiBsb2dEYXRhYmFzZUNvbmZpZ3VyYXRpb24uZGF0YWJhc2UsXG4gICAgICAgIHVzZXI6IGxvZ0RhdGFiYXNlQ29uZmlndXJhdGlvbi51c2VyLFxuICAgICAgICBwYXNzd29yZDogbG9nRGF0YWJhc2VDb25maWd1cmF0aW9uLnBhc3N3b3JkLFxuICAgICAgfSwgZGVmYXVsdENvbmZpZ3VyYXRpb24pKTtcblxuICAgICAgdmFyIHJhbmtpbmdEYXRhYmFzZUNvbmZpZ3VyYXRpb24gPSBjb25maWd1cmF0aW9uLnJhbmtpbmdEYXRhYmFzZUNvbmZpZ3VyYXRpb247XG4gICAgICByYW5raW5nRGF0YWJhc2UgPSBteXNxbC5jcmVhdGVQb29sKF8uZXh0ZW5kKHtcbiAgICAgICAgaG9zdDogcmFua2luZ0RhdGFiYXNlQ29uZmlndXJhdGlvbi5ob3N0LFxuICAgICAgICBkYXRhYmFzZTogcmFua2luZ0RhdGFiYXNlQ29uZmlndXJhdGlvbi5kYXRhYmFzZSxcbiAgICAgICAgdXNlcjogcmFua2luZ0RhdGFiYXNlQ29uZmlndXJhdGlvbi51c2VyLFxuICAgICAgICBwYXNzd29yZDogcmFua2luZ0RhdGFiYXNlQ29uZmlndXJhdGlvbi5wYXNzd29yZCxcbiAgICAgIH0sIGRlZmF1bHRDb25maWd1cmF0aW9uKSk7XG5cbiAgICAgIHZhciBzZWFzb25EYXRhYmFzZUNvbmZpZ3VyYXRpb24gPSBjb25maWd1cmF0aW9uLnNlYXNvbkRhdGFiYXNlQ29uZmlndXJhdGlvbjtcbiAgICAgIHNlYXNvbkRhdGFiYXNlID0gbXlzcWwuY3JlYXRlUG9vbChfLmV4dGVuZCh7XG4gICAgICAgIGhvc3Q6IHNlYXNvbkRhdGFiYXNlQ29uZmlndXJhdGlvbi5ob3N0LFxuICAgICAgICBkYXRhYmFzZTogc2Vhc29uRGF0YWJhc2VDb25maWd1cmF0aW9uLmRhdGFiYXNlLFxuICAgICAgICB1c2VyOiBzZWFzb25EYXRhYmFzZUNvbmZpZ3VyYXRpb24udXNlcixcbiAgICAgICAgcGFzc3dvcmQ6IHNlYXNvbkRhdGFiYXNlQ29uZmlndXJhdGlvbi5wYXNzd29yZCxcbiAgICAgIH0sIGRlZmF1bHRDb25maWd1cmF0aW9uKSk7XG5cbiAgICAgIHZhciBhZG1pbkRhdGFiYXNlQ29uZmlndXJhdGlvbiA9IGNvbmZpZ3VyYXRpb24uYWRtaW5EYXRhYmFzZUNvbmZpZ3VyYXRpb247XG4gICAgICBhZG1pbkRhdGFiYXNlID0gbXlzcWwuY3JlYXRlUG9vbChfLmV4dGVuZCh7XG4gICAgICAgIGhvc3Q6IGFkbWluRGF0YWJhc2VDb25maWd1cmF0aW9uLmhvc3QsXG4gICAgICAgIGRhdGFiYXNlOiBhZG1pbkRhdGFiYXNlQ29uZmlndXJhdGlvbi5kYXRhYmFzZSxcbiAgICAgICAgdXNlcjogYWRtaW5EYXRhYmFzZUNvbmZpZ3VyYXRpb24udXNlcixcbiAgICAgICAgcGFzc3dvcmQ6IGFkbWluRGF0YWJhc2VDb25maWd1cmF0aW9uLnBhc3N3b3JkLFxuICAgICAgfSwgZGVmYXVsdENvbmZpZ3VyYXRpb24pKTtcblxuICAgICAgdmFyIGJvYXJkRGF0YWJhc2VDb25maWd1cmF0aW9uID0gY29uZmlndXJhdGlvbi5ib2FyZERhdGFiYXNlQ29uZmlndXJhdGlvbjtcbiAgICAgIGJvYXJkRGF0YWJhc2UgPSBteXNxbC5jcmVhdGVQb29sKF8uZXh0ZW5kKHtcbiAgICAgICAgaG9zdDogYm9hcmREYXRhYmFzZUNvbmZpZ3VyYXRpb24uaG9zdCxcbiAgICAgICAgZGF0YWJhc2U6IGJvYXJkRGF0YWJhc2VDb25maWd1cmF0aW9uLmRhdGFiYXNlLFxuICAgICAgICB1c2VyOiBib2FyZERhdGFiYXNlQ29uZmlndXJhdGlvbi51c2VyLFxuICAgICAgICBwYXNzd29yZDogYm9hcmREYXRhYmFzZUNvbmZpZ3VyYXRpb24ucGFzc3dvcmQsXG4gICAgICB9LCBkZWZhdWx0Q29uZmlndXJhdGlvbikpO1xuXG4gICAgICB2YXIgZXZlbnREYXRhYmFzZUNvbmZpZ3VyYXRpb24gPSBjb25maWd1cmF0aW9uLmV2ZW50RGF0YWJhc2VDb25maWd1cmF0aW9uO1xuICAgICBldmVudERhdGFiYXNlID0gbXlzcWwuY3JlYXRlUG9vbChfLmV4dGVuZCh7XG4gICAgICAgIGhvc3Q6IGV2ZW50RGF0YWJhc2VDb25maWd1cmF0aW9uLmhvc3QsXG4gICAgICAgIGRhdGFiYXNlOiBldmVudERhdGFiYXNlQ29uZmlndXJhdGlvbi5kYXRhYmFzZSxcbiAgICAgICAgdXNlcjogZXZlbnREYXRhYmFzZUNvbmZpZ3VyYXRpb24udXNlcixcbiAgICAgICAgcGFzc3dvcmQ6IGV2ZW50RGF0YWJhc2VDb25maWd1cmF0aW9uLnBhc3N3b3JkLFxuICAgICAgfSwgZGVmYXVsdENvbmZpZ3VyYXRpb24pKTtcblxuICAgICAgY2FsbGJhY2soKTtcbiAgICB9XG4gIH0pO1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGluaXRpYWxpemVGb3JUZXN0KGNhbGxiYWNrOiBFcnJvckNhbGxiYWNrKSB7XG4gIGluaXRpYWxpemUobmV3IE9wdGlvbnMoJ3Rlc3QnKSwgY2FsbGJhY2spO1xufVxuXG5mdW5jdGlvbiBxdWVyeVRvRGF0YWJhc2U8Uj4oZGF0YWJhc2U6IG15c3FsLklQb29sLCBxdWVyeTogc3RyaW5nLCB2YWx1ZXM6IGFueSwgY2FsbGJhY2s6IEFzeW5jUmVzdWx0Q2FsbGJhY2s8Uj4pOiB2b2lkIHtcbiAgZGF0YWJhc2UucXVlcnkoe1xuICAgIHNxbDogcXVlcnksXG4gICAgdHlwZUNhc3Q6IGZ1bmN0aW9uIChmaWVsZCwgbmV4dCkge1xuICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICdUSU5ZJyAmJiBmaWVsZC5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgcmV0dXJuIGZpZWxkLnN0cmluZygpID09PSAnMSc7XG4gICAgICB9XG4gICAgICByZXR1cm4gbmV4dCgpO1xuICAgIH1cbiAgfSwgdmFsdWVzLCBmdW5jdGlvbiAoZXJyOiBteXNxbC5JRXJyb3IsIHJvd3M6IGFueSk6IHZvaWQge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0RhdGFiYXNlRXJyb3InKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyLnN0YWNrKTtcbiAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNhbGxiYWNrKG51bGwsIHJvd3MpO1xuICAgIH1cbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBxdWVyeVRpY2tldERhdGFiYXNlPFI+KHF1ZXJ5OiBzdHJpbmcsIHZhbHVlczogYW55LCBjYWxsYmFjazogQXN5bmNSZXN1bHRDYWxsYmFjazxSPik6IHZvaWQge1xuICBxdWVyeVRvRGF0YWJhc2UodGlja2V0RGF0YWJhc2UsIHF1ZXJ5LCB2YWx1ZXMsIGNhbGxiYWNrKTtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBxdWVyeVJhbmtpbmdEYXRhYmFzZTxSPihxdWVyeTogc3RyaW5nLCB2YWx1ZXM6IGFueSwgY2FsbGJhY2s6IEFzeW5jUmVzdWx0Q2FsbGJhY2s8Uj4pOiB2b2lkIHtcbiAgcXVlcnlUb0RhdGFiYXNlKHJhbmtpbmdEYXRhYmFzZSwgcXVlcnksIHZhbHVlcywgY2FsbGJhY2spO1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIHF1ZXJ5QWxsR2FtZURhdGFiYXNlcyhxdWVyeTogc3RyaW5nLCB2YWx1ZXM6IGFueSwgY2FsbGJhY2s6IEFzeW5jUmVzdWx0QXJyYXlDYWxsYmFjazxhbnk+KTogdm9pZCB7XG4gIHZhciBxdWVyeUZ1bmN0aW9uczogYW55ID0gXy5tYXAoZ2FtZURhdGFiYXNlcywgZnVuY3Rpb24gKGdhbWVEYXRhYmFzZTogbXlzcWwuSVBvb2wpOiBGdW5jdGlvbiB7XG4gICAgcmV0dXJuIF8ucGFydGlhbChxdWVyeVRvRGF0YWJhc2UsIGdhbWVEYXRhYmFzZSwgcXVlcnksIHZhbHVlcyk7XG4gIH0pO1xuICBhc3luYy5wYXJhbGxlbChxdWVyeUZ1bmN0aW9ucywgZnVuY3Rpb24gKGVycjogbXlzcWwuSUVycm9yLCBhcnJheU9mUm93czogYW55W11bXSkge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNhbGxiYWNrKG51bGwsIF8uZmxhdHRlbihhcnJheU9mUm93cykpO1xuICAgIH1cbiAgfSk7XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gcXVlcnlHYW1lRGF0YWJhc2U8Uj4odGlja2V0LCBxdWVyeTogc3RyaW5nLCB2YWx1ZXM6IGFueSwgY2FsbGJhY2s6IEFzeW5jUmVzdWx0Q2FsbGJhY2s8Uj4pOiB2b2lkIHtcbiAgdmFyIGdhbWVEYXRhYmFzZSA9IGdhbWVEYXRhYmFzZXNbdGlja2V0ICUgZ2FtZURhdGFiYXNlcy5sZW5ndGhdO1xuXG4gIHF1ZXJ5VG9EYXRhYmFzZShnYW1lRGF0YWJhc2UsIHF1ZXJ5LCB2YWx1ZXMsIGNhbGxiYWNrKTtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBxdWVyeUxvZ0RhdGFiYXNlPFI+KHF1ZXJ5OiBzdHJpbmcsIHZhbHVlczogYW55LCBjYWxsYmFjazogQXN5bmNSZXN1bHRDYWxsYmFjazxSPik6IHZvaWQge1xuICBxdWVyeVRvRGF0YWJhc2UobG9nRGF0YWJhc2UsIHF1ZXJ5LCB2YWx1ZXMsIGNhbGxiYWNrKTtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBxdWVyeVNlYXNvbkRhdGFiYXNlPFI+KHF1ZXJ5OiBzdHJpbmcsIHZhbHVlczogYW55LCBjYWxsYmFjazogQXN5bmNSZXN1bHRDYWxsYmFjazxSPik6IHZvaWQge1xuICBxdWVyeVRvRGF0YWJhc2Uoc2Vhc29uRGF0YWJhc2UsIHF1ZXJ5LCB2YWx1ZXMsIGNhbGxiYWNrKTtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBxdWVyeUFkbWluRGF0YWJhc2U8Uj4ocXVlcnk6IHN0cmluZywgdmFsdWVzOiBhbnksIGNhbGxiYWNrOiBBc3luY1Jlc3VsdENhbGxiYWNrPFI+KTogdm9pZCB7XG4gIHF1ZXJ5VG9EYXRhYmFzZShhZG1pbkRhdGFiYXNlLCBxdWVyeSwgdmFsdWVzLCBjYWxsYmFjayk7XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gcXVlcnlCb2FyZERhdGFiYXNlPFI+KHF1ZXJ5OiBzdHJpbmcsIHZhbHVlczogYW55LCBjYWxsYmFjazogQXN5bmNSZXN1bHRDYWxsYmFjazxSPik6IHZvaWQge1xuICBxdWVyeVRvRGF0YWJhc2UoYm9hcmREYXRhYmFzZSwgcXVlcnksIHZhbHVlcywgY2FsbGJhY2spO1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIHF1ZXJ5RXZlbnREYXRhYmFzZTxSPihxdWVyeTogc3RyaW5nLCB2YWx1ZXM6IGFueSwgY2FsbGJhY2s6IEFzeW5jUmVzdWx0Q2FsbGJhY2s8Uj4pOiB2b2lkIHtcbiAgcXVlcnlUb0RhdGFiYXNlKGV2ZW50RGF0YWJhc2UsIHF1ZXJ5LCB2YWx1ZXMsIGNhbGxiYWNrKTtcbn07XG5cbmV4cG9ydCBtb2R1bGUgdHJhbnNhY3Rpb24ge1xuICBleHBvcnQgY2xhc3MgVHJhbnNhY3Rpb25DbGFzcyB7XG4gICAgcHJpdmF0ZSBjb25uZWN0aW9uOiBteXNxbC5JQ29ubmVjdGlvbjtcbiAgICBjb25zdHJ1Y3Rvcihjb25uZWN0aW9uOiBteXNxbC5JQ29ubmVjdGlvbikge1xuICAgICAgdGhpcy5jb25uZWN0aW9uID0gY29ubmVjdGlvbjtcbiAgICB9XG5cbiAgICBiZWdpbjxSPihjYWxsYmFjazogQXN5bmNSZXN1bHRDYWxsYmFjazxSPik6IHZvaWQge1xuICAgICAgdGhpcy5jb25uZWN0aW9uLmJlZ2luVHJhbnNhY3Rpb24oY2FsbGJhY2spO1xuICAgIH1cblxuICAgIHF1ZXJ5PFI+KHF1ZXJ5OiBzdHJpbmcsIHZhbHVlczogYW55LCBjYWxsYmFjazogQXN5bmNSZXN1bHRDYWxsYmFjazxSPik6IHZvaWQge1xuICAgICAgdGhpcy5jb25uZWN0aW9uLnF1ZXJ5KHtcbiAgICAgICAgc3FsOiBxdWVyeSxcbiAgICAgICAgdHlwZUNhc3Q6IGZ1bmN0aW9uIChmaWVsZCwgbmV4dCkge1xuICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAnVElOWScgJiYgZmllbGQubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICByZXR1cm4gZmllbGQuc3RyaW5nKCkgPT09ICcxJztcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICAgICAgfVxuICAgICAgfSwgdmFsdWVzLCBmdW5jdGlvbiAoZXJyOiBteXNxbC5JRXJyb3IsIHJvd3M6IGFueSk6IHZvaWQge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRGF0YWJhc2VFcnJvcicpO1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGVyci5zdGFjayk7XG4gICAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByb3dzKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29tbWl0PFI+KGNhbGxiYWNrOiBBc3luY1Jlc3VsdENhbGxiYWNrPFI+KTogdm9pZCB7XG4gICAgICB0aGlzLmNvbm5lY3Rpb24uY29tbWl0KGNhbGxiYWNrKTtcbiAgICB9XG5cbiAgICByb2xsYmFjazxSPihjYWxsYmFjazogRXJyb3JDYWxsYmFjayk6IHZvaWQge1xuICAgICAgdGhpcy5jb25uZWN0aW9uLnJvbGxiYWNrKGNhbGxiYWNrKTtcbiAgICB9XG5cbiAgICByZWxlYXNlPFI+KGNhbGxiYWNrOiBFcnJvckNhbGxiYWNrKTogdm9pZCB7XG4gICAgICB0aGlzLmNvbm5lY3Rpb24ucmVsZWFzZSgpO1xuICAgICAgY2FsbGJhY2soKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBnZXRDb25uZWN0aW9uRnJvbUdhbWVEQjxSPih0aWNrZXQ6IG51bWJlciwgY2FsbGJhY2s6IGFueSkge1xuICAgIHZhciBnYW1lRGF0YWJhc2UgPSBnYW1lRGF0YWJhc2VzW3RpY2tldCAlIGdhbWVEYXRhYmFzZXMubGVuZ3RoXTtcbiAgICBnYW1lRGF0YWJhc2UuZ2V0Q29ubmVjdGlvbihjYWxsYmFjayk7XG4gIH1cblxuICBleHBvcnQgZnVuY3Rpb24gZ2V0R2FtZURCVHJhbnNhY3Rpb24odGlja2V0OiBudW1iZXIsIGNhbGxiYWNrOiAoZXJyOiBFcnJvciwgdHJhbnNhY3Rpb24/OiB0cmFuc2FjdGlvbi5UcmFuc2FjdGlvbkNsYXNzKSA9PiB2b2lkKSB7XG4gICAgZ2V0Q29ubmVjdGlvbkZyb21HYW1lREIodGlja2V0LCBmdW5jdGlvbiAoZXJyOiBFcnJvciwgY29ubmVjdGlvbjogbXlzcWwuSUNvbm5lY3Rpb24pIHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIG5ldyBUcmFuc2FjdGlvbkNsYXNzKGNvbm5lY3Rpb24pKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBlc2NhcGUoaWRlbnRpZmllcjogYW55KTogc3RyaW5nIHtcbiAgcmV0dXJuIG15c3FsLmVzY2FwZShpZGVudGlmaWVyKTtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBlbmQoY2FsbGJhY2s/OiBFcnJvckNhbGxiYWNrKTogdm9pZCB7XG4gIHZhciBwb29sczogbXlzcWwuSVBvb2xbXSA9IFtcbiAgICB0aWNrZXREYXRhYmFzZSxcbiAgICByYW5raW5nRGF0YWJhc2UsXG4gICAgbG9nRGF0YWJhc2UsXG4gICAgc2Vhc29uRGF0YWJhc2UsXG4gICAgYWRtaW5EYXRhYmFzZSxcbiAgICBib2FyZERhdGFiYXNlLFxuICAgIGV2ZW50RGF0YWJhc2VcbiAgXVxuICAuY29uY2F0KGdhbWVEYXRhYmFzZXMpXG4gIC5maWx0ZXIoZnVuY3Rpb24gKHBvb2w6IG15c3FsLklQb29sKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICEhcG9vbDtcbiAgfSk7XG5cbiAgYXN5bmMuc2VyaWVzKHBvb2xzLm1hcChmdW5jdGlvbiAocG9vbDogbXlzcWwuSVBvb2wpOiAoYW55KSA9PiB2b2lkIHtcbiAgICByZXR1cm4gcG9vbC5lbmQuYmluZChwb29sKTtcbiAgfSksIGNhbGxiYWNrKTtcbn07XG4iXX0=
